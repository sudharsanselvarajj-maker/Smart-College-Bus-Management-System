<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Smart Bus System — Login</title>

  <!-- Bootstrap (for quick UI) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom styles -->
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

  <!-- BACKGROUND IMAGE (animated pan effect via CSS).
       You already load an image on .bg-media (local file).
  -->
  <div class="bg-media" aria-hidden="true" style="background-image: url('./smart\ bus\ attendance\ system1221.png');"></div>

  <!-- Top controls: only theme toggle (replaced text with a fancy circular icon button) -->
  <div class="top-controls">
    <button id="themeToggle" class="btn-theme-toggle" aria-label="Toggle theme" title="Toggle dark/light mode" type="button">
      <!-- JS will inject the correct SVG icon (no text inside the button) -->
    </button>
  </div>

  <main class="container-fluid vh-100 d-flex align-items-center justify-content-center">
    <div class="row w-100 gx-0 justify-content-center">
      <!-- Left visual panel (hidden on small screens) -->
      <aside class="col-md-6 d-none d-md-flex visual-panel align-items-center justify-content-center">
        <div class="visual-inner text-center">
          <div></div>
        </div>
      </aside>

      <!-- Right: Login form -->
      <section class="col-12 col-md-6 d-flex align-items-center justify-content-center p-4">
        <div class="auth-card shadow-sm">
          <div class="card-header text-center mb-3">
            <h2 class="h4 mb-1">Welcome Back</h2>
            <small class="text-muted">Sign in to continue to Smart Bus System</small>
          </div>

          <div id="alertContainer" class="mb-3"></div>

          <form id="loginForm" novalidate>
            <div class="mb-3 form-floating">
              <input type="email" class="form-control" id="email" placeholder="name@example.com" required>
              <label for="email">Email address</label>
            </div>

            <div class="mb-3 form-floating position-relative">
              <input type="password" class="form-control" id="password" placeholder="Password" required>
              <label for="password">Password</label>
              <button type="button" id="pwdToggle" class="btn btn-sm btn-link position-absolute pwd-toggle" aria-label="Show password">Show</button>
            </div>

            <div class="mb-3">
              <label for="role" class="form-label">Login as</label>
              <select class="form-select" id="role" required>
                <option value="" disabled selected>Select role</option>
                <option value="student">Student</option>
                <option value="incharge">Bus In-charge</option>
                <option value="admin">Admin</option>
              </select>
            </div>

            <div class="mb-3 form-check">
              <input type="checkbox" class="form-check-input" id="terms" required>
              <label class="form-check-label" for="terms">I agree to the <a href="#" target="_blank" rel="noopener">Terms & Conditions</a></label>
            </div>

            <div class="d-grid mb-2">
              <button type="submit" class="btn btn-primary">Sign in</button>
            </div>

            <div class="text-center small">
              Don't have an account? <a href="register.html">Register</a>
            </div>
          </form>
        </div>
      </section>
    </div>
  </main>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Page script (theme button updated to use icons instead of text) -->
  <script>
    /* ==== USER DATA (same as original) ==== */
    const users = {
      students: [{ email: 'student@test.com', password: 'student123', studentId: 'STU001', fullname: 'John Doe', phone: '9876543210', busRoute: 'route1' }],
      incharge: [{ email: 'incharge@test.com', password: 'incharge123', fullname: 'Mike Johnson', busNumber: 'BUS001' }],
      admin: [{ email: 'admin@test.com', password: 'admin123', fullname: 'Admin User' }]
    };

    /* ====== UI elements ====== */
    const alertBox = document.getElementById('alertContainer');
    const loginForm = document.getElementById('loginForm');
    const pwdToggle = document.getElementById('pwdToggle');
    const passwordInput = document.getElementById('password');
    const themeToggle = document.getElementById('themeToggle');

    /* ===== SVG ICONS (uses currentColor for easy theming) ===== */
    const ICONS = {
      sun: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="M4.93 4.93l1.41 1.41"></path><path d="M17.66 17.66l1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="M4.93 19.07l1.41-1.41"></path><path d="M17.66 6.34l1.41-1.41"></path></svg>`,
      moon: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>`
    };

    function updateThemeButtonIcon(theme) {
      // If the current theme is dark, show the sun icon (indicating action -> switch to light)
      if (theme === 'dark') {
        themeToggle.innerHTML = ICONS.sun;
        themeToggle.setAttribute('aria-label', 'Switch to light mode');
        themeToggle.title = 'Switch to light mode';
        themeToggle.classList.add('is-dark');
      } else {
        themeToggle.innerHTML = ICONS.moon;
        themeToggle.setAttribute('aria-label', 'Switch to dark mode');
        themeToggle.title = 'Switch to dark mode';
        themeToggle.classList.remove('is-dark');
      }
    }

    function setTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      localStorage.setItem('sbs_theme', theme);
      updateThemeButtonIcon(theme);
    }

    // initialize theme from localStorage or system preference
    (function initTheme() {
      const saved = localStorage.getItem('sbs_theme');
      if (saved) setTheme(saved);
      else {
        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        setTheme(prefersDark ? 'dark' : 'light');
      }
    })();

    themeToggle.addEventListener('click', () => {
      const current = document.documentElement.getAttribute('data-theme') || 'light';
      setTheme(current === 'dark' ? 'light' : 'dark');
    });

    function showAlert(message, type = 'danger', timeout = 3500) {
      alertBox.innerHTML = `<div class="alert alert-${type} alert-dismissible fade show" role="alert">${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>`;
      if (timeout) setTimeout(()=> { const el = alertBox.querySelector('.alert'); if (el) bootstrap.Alert.getOrCreateInstance(el).close(); }, timeout);
    }

    pwdToggle.addEventListener('click', () => {
      const isPwd = passwordInput.type === 'password';
      passwordInput.type = isPwd ? 'text' : 'password';
      pwdToggle.textContent = isPwd ? 'Hide' : 'Show';
    });

    loginForm.addEventListener('submit', function (e) {
      e.preventDefault();
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      const role = document.getElementById('role').value;
      if (!email || !password || !role) { showAlert('Please fill in all required fields and choose a role', 'warning'); return; }
      const userList = role === 'student' ? users.students : role === 'incharge' ? users.incharge : users.admin;
      const user = userList.find(u => u.email.toLowerCase() === email.toLowerCase() && u.password === password);
      if (!user) { showAlert('Invalid email or password', 'danger'); return; }
      localStorage.setItem('role', role); localStorage.setItem('fullname', user.fullname || '');
      showAlert('Login successful — redirecting...', 'success', 1200);
      setTimeout(() => {
        if (role === 'student') window.location.href = 'student-dashboard.html';
        else if (role === 'incharge') window.location.href = 'incharge-dashboard.html';
        else window.location.href = 'admin-dashboard.html';
      }, 900);
    });
  </script>
</body>
</html>