<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Student Dashboard — Smart Bus System</title>

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <!-- App styles -->
  <link rel="stylesheet" href="css/style.css">

  <!-- Important note:
       Replace YOUR_GOOGLE_MAPS_API_KEY with a valid key. If you prefer not to use Google Maps,
       swap the script for a Leaflet integration in js/student-dashboard.js and remove this line. -->
  <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY" defer></script>

  <!-- QR scanner -->
  <script src="https://unpkg.com/html5-qrcode" defer></script>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark topbar" style="background-color: blue;">
    <div class="container-fluid">
      <a class="navbar-brand d-flex align-items-center" href="#">
        <img src="logo192.png" alt="Smart Bus logo" class="brand-logo me-2" loading="lazy" style="width: 50px; height: 50px;">
        <div>
          <div class="brand-title">Smart Bus System</div>
        </div>
      </a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu"
              aria-controls="navMenu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navMenu">
        <ul class="navbar-nav ms-auto align-items-center">
          <li class="nav-item me-2">
            <a class="nav-link" href="#" data-section="dashboard"><i class="bi bi-speedometer2"></i> Dashboard</a>
          </li>
          <li class="nav-item me-2">
            <a class="nav-link" href="#" data-section="attendance"><i class="bi bi-camera"></i> Attendance</a>
          </li>
          <li class="nav-item me-2">
            <a class="nav-link" href="#" data-section="tracking"><i class="bi bi-geo-alt"></i> Track Bus</a>
          </li>
          <li class="nav-item me-3">
            <a class="nav-link" href="#" data-section="complaints"><i class="bi bi-exclamation-circle"></i> Complaints</a>
          </li>

          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userDropdown" role="button"
               data-bs-toggle="dropdown" aria-expanded="false">
              <img id="studentAvatar" src="account-icon.svg" alt="avatar" class="avatar me-2">
              <span id="studentNameNav">User</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
              <li><a class="dropdown-item" href="#" id="profileBtn">Profile</a></li>
              <li><hr class="dropdown-divider"></li>
              <!-- Changed from <a href="#"> to <button> using Bootstrap's HTML modal API -->
              <li>
                <button class="dropdown-item text-danger" type="button"
                        id="logoutBtn" data-bs-toggle="modal" data-bs-target="#logoutModal">
                  Logout <i class="bi bi-box-arrow-right"></i>
                </button>
              </li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="container-fluid my-4">
    <div class="row g-4">
      <!-- Dashboard -->
      <section id="dashboard" class="col-12 section-card" aria-labelledby="dashboardHeading">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <h2 id="dashboardHeading" class="h4 mb-0">Overview</h2>
          <div>
            <button class="btn btn-outline-secondary me-2" id="refreshDashboardBtn"><i class="bi bi-arrow-clockwise"></i> Refresh</button>
            <small class="text-muted" id="lastSync">Last sync: —</small>
          </div>
        </div>

        <div class="row gy-3">
          <div class="col-sm-6 col-xl-3">
            <div class="card stat-card shadow-sm">
              <div class="card-body">
                <div class="d-flex align-items-center">
                  <div class="stat-icon bg-success text-white me-3"><i class="bi bi-check2-circle"></i></div>
                  <div>
                    <div class="small text-muted">Attendance Rate</div>
                    <div class="h4 mb-0" id="attendanceRate">0%</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-sm-6 col-xl-3">
            <div class="card stat-card shadow-sm">
              <div class="card-body">
                <div class="d-flex align-items-center">
                  <div class="stat-icon bg-info text-white me-3"><i class="bi bi-wallet2"></i></div>
                  <div>
                    <div class="small text-muted">Fee Status</div>
                    <div class="h5 mb-0" id="feeStatus">Paid</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-sm-6 col-xl-3">
            <div class="card stat-card shadow-sm">
              <div class="card-body">
                <div class="d-flex align-items-center">
                  <div class="stat-icon bg-warning text-white me-3"><i class="bi bi-exclamation-triangle"></i></div>
                  <div>
                    <div class="small text-muted">Total Complaints</div>
                    <div class="h4 mb-0" id="totalComplaints">0</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-sm-6 col-xl-3">
            <div class="card stat-card shadow-sm">
              <div class="card-body">
                <div class="d-flex align-items-center">
                  <div class="stat-icon bg-primary text-white me-3"><i class="bi bi-bus-front"></i></div>
                  <div>
                    <div class="small text-muted">Bus Number</div>
                    <div class="h5 mb-0" id="busNumber">—</div>
                    <small class="text-muted d-block" id="routeInfo">Route: —</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick action cards -->
        <div class="row mt-4 gy-3">
          <div class="col-md-6">
            <div class="card action-card h-100">
              <div class="card-body d-flex flex-column justify-content-between">
                <div>
                  <h5 class="card-title">Mark Attendance</h5>
                  <p class="card-text text-muted">Scan QR or enter the code to mark your ride attendance quickly.</p>
                </div>
                <div class="d-flex gap-2">
                  <button class="btn btn-primary" data-section="attendance"><i class="bi bi-camera"></i> Scan QR</button>
                  <button class="btn btn-outline-primary" id="manualMarkBtn"><i class="bi bi-pencil"></i> Enter Code</button>
                </div>
              </div>
            </div>
          </div>

          <div class="col-md-6">
            <div class="card action-card h-100">
              <div class="card-body d-flex flex-column justify-content-between">
                <div>
                  <h5 class="card-title">Track Bus</h5>
                  <p class="card-text text-muted">Open the live map to see real-time bus location and estimated arrival.</p>
                </div>
                <div class="d-flex gap-2">
                  <button class="btn btn-success" data-section="tracking"><i class="bi bi-geo-alt"></i> View Map</button>
                  <button class="btn btn-outline-success" id="refreshLocationSmallBtn"><i class="bi bi-arrow-repeat"></i> Refresh</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Attendance Section -->
      <section id="attendance" class="col-12 section-card d-none" aria-labelledby="attendanceHeading">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <h2 id="attendanceHeading" class="h4 mb-0">Mark Attendance</h2>
          <div><small class="text-muted">Tip: Allow camera access for QR scanning</small></div>
        </div>

        <div class="row gy-3">
          <div class="col-lg-6">
            <div class="card shadow-sm">
              <div class="card-body text-center">
                <h5 class="card-title">Scan QR Code</h5>
                <div id="qrReader" class="qr-box mb-3" aria-live="polite" aria-label="QR code scanner area"></div>
                <div class="d-flex justify-content-center gap-2">
                  <button id="startScanBtn" class="btn btn-primary"><i class="bi bi-camera-video"></i> Start Scanning</button>
                  <button id="stopScanBtn" class="btn btn-secondary d-none"><i class="bi bi-camera-video-off"></i> Stop</button>
                </div>
                <div class="mt-3">
                  <small id="qrStatus" class="text-muted">Scanner idle</small>
                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-6">
            <div class="card shadow-sm">
              <div class="card-body">
                <h5 class="card-title">Enter Code Manually</h5>
                <div class="input-group mb-3">
                  <input type="text" id="manualCode" class="form-control" placeholder="Enter attendance code" aria-label="Attendance code">
                  <button class="btn btn-success" id="submitCodeBtn">Submit</button>
                </div>

                <hr>

                <h5 class="card-title">Attendance History</h5>
                <div class="table-responsive">
                  <table class="table table-sm align-middle">
                    <thead class="table-light">
                      <tr>
                        <th>Date</th>
                        <th>Time</th>
                        <th>Status</th>
                        <th>Mode</th>
                      </tr>
                    </thead>
                    <tbody id="attendanceHistory">
                      <!-- injected -->
                    </tbody>
                  </table>
                </div>
                <small class="text-muted">Showing last 20 entries (demo)</small>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Tracking Section -->
      <section id="tracking" class="col-12 section-card d-none" aria-labelledby="trackingHeading">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <h2 id="trackingHeading" class="h4 mb-0">Track Your Bus</h2>
          <div>
            <button class="btn btn-outline-secondary" id="centerMapBtn" title="Center map"><i class="bi bi-geo-alt-fill"></i></button>
            <button class="btn btn-primary" id="refreshLocationBtn"><i class="bi bi-arrow-clockwise"></i> Refresh</button>
          </div>
        </div>

        <div class="card shadow-sm">
          <div class="card-body">
            <div id="map" class="map-area" role="region" aria-label="Live bus location map">Loading map…</div>

            <div class="mt-3 d-flex gap-4 flex-wrap">
              <div><strong>Bus:</strong> <span id="trackBusNumber">—</span></div>
              <div><strong>Current:</strong> <span id="currentLocation">—</span></div>
              <div><strong>Last Updated:</strong> <span id="lastUpdated">—</span></div>
            </div>
          </div>
        </div>
      </section>

      <!-- Complaints -->
      <section id="complaints" class="col-12 section-card d-none" aria-labelledby="complaintsHeading">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <h2 id="complaintsHeading" class="h4 mb-0">Complaints</h2>
          <div>
            <button class="btn btn-primary" id="newComplaintBtn"><i class="bi bi-plus-circle"></i> New Complaint</button>
          </div>
        </div>

        <div class="row gy-3">
          <div class="col-lg-4">
            <div class="card shadow-sm">
              <div class="card-body">
                <h5 class="card-title">Submit Complaint</h5>
                <form id="complaintForm" novalidate>
                  <div class="mb-3">
                    <label class="form-label" for="complaintSubject">Subject</label>
                    <input id="complaintSubject" class="form-control" required maxlength="100">
                    <div class="invalid-feedback">Please provide a brief subject.</div>
                  </div>
                  <div class="mb-3">
                    <label class="form-label" for="complaintDescription">Description</label>
                    <textarea id="complaintDescription" class="form-control" rows="4" required maxlength="800"></textarea>
                    <div class="invalid-feedback">Please describe your complaint.</div>
                  </div>
                  <button class="btn btn-primary w-100" type="submit">Submit Complaint</button>
                </form>
              </div>
            </div>
          </div>

          <div class="col-lg-8">
            <div class="card shadow-sm">
              <div class="card-body">
                <h5 class="card-title">My Complaints</h5>
                <div id="complaintsList" class="list-group">
                  <!-- injected -->
                </div>
                <small class="text-muted d-block mt-2">Complaints are stored locally in demo mode.</small>
              </div>
            </div>
          </div>
        </div>
      </section>

    </div>
  </main>

  <!-- Toast container -->
  <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1200">
    <div id="toastContainer" class="toast-container"></div>
  </div>

  <!-- Modal: Logout confirmation -->
  <div class="modal fade" id="logoutModal" tabindex="-1" aria-hidden="true" aria-labelledby="logoutModalLabel">
    <div class="modal-dialog modal-sm modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-body text-center">
          <h5 id="logoutModalLabel">Confirm logout?</h5>
          <p class="small text-muted">You will be signed out of this session.</p>
          <div class="d-flex gap-2 justify-content-center">
            <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button class="btn btn-danger" id="confirmLogoutBtn">Logout</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="js/student-dashboard.js" defer></script>
</body>
</html>